"use strict";(self["webpackChunkvue_proyecto"]=self["webpackChunkvue_proyecto"]||[]).push([[440],{9440:function(e,t,n){n.r(t),n.d(t,{default:function(){return B}});var s=n(4108),a=n(9096),o=n(7764);const i={key:0},c={class:"event__information"},m={class:"event__header"},r=["src","alt"],d={class:"event__body"},v={key:0},l={key:1},h={key:2},u={key:3},p={key:4},k={key:5},y=["href"],_=(0,s.QD)("h2",null,"Escribe tu comentario",-1),g={key:1,class:"event__comments"},A=(0,s.QD)("h3",null,"Comentarios",-1),f={class:"event__comment"},W={class:"event__comment__info"},b={class:"event__comment__body"};function w(e,t,n,w,z,C){return z.event?((0,s.Wz)(),(0,s.An)("section",i,[(0,s.QD)("section",c,[(0,s.QD)("article",m,[(0,s.QD)("h1",null,(0,a.WA)(z.event.name),1),z.event.images?((0,s.Wz)(),(0,s.An)("img",{key:0,src:z.event.images[0].url,alt:z.event.name},null,8,r)):(0,s.g1)("",!0)]),(0,s.QD)("article",d,[z.event.dates.start.dateTBD||z.event.dates.start.dateTBA?(0,s.g1)("",!0):((0,s.Wz)(),(0,s.An)("p",v,"Fecha del evento: "+(0,a.WA)(z.event.dates.start.localDate),1)),z.event._embedded&&z.event._embedded.venues?((0,s.Wz)(),(0,s.An)("p",l,"En: "+(0,a.WA)(z.event._embedded.venues[0].country.name)+", "+(0,a.WA)(z.event._embedded.venues[0].city.name),1)):(0,s.g1)("",!0),z.event.info?((0,s.Wz)(),(0,s.An)("p",h,(0,a.WA)(z.event.info),1)):(0,s.g1)("",!0),z.event.pleaseNote?((0,s.Wz)(),(0,s.An)("p",u,(0,a.WA)(z.event.pleaseNote),1)):(0,s.g1)("",!0),z.event.ticketLimit?((0,s.Wz)(),(0,s.An)("p",p,(0,a.WA)(z.event.ticketLimit.info),1)):(0,s.g1)("",!0),z.event.seatmap?((0,s.Wz)(),(0,s.An)("button",k,"Ver mapa del recinto")):(0,s.g1)("",!0),z.event.url?((0,s.Wz)(),(0,s.An)("a",{key:6,href:z.event.url,target:"_blank"},"Comprar entradas",8,y)):(0,s.g1)("",!0),!z.saved&&z.user?((0,s.Wz)(),(0,s.An)("button",{key:7,onClick:t[0]||(t[0]=(...e)=>C.saveEvent&&C.saveEvent(...e))},"Guardar evento")):(0,s.g1)("",!0),z.saved&&z.user?((0,s.Wz)(),(0,s.An)("button",{key:8,onClick:t[1]||(t[1]=(...e)=>C.removeEvent&&C.removeEvent(...e))},"Borrar evento")):(0,s.g1)("",!0)])]),z.user?((0,s.Wz)(),(0,s.An)("section",{class:"event__commentbox__container",key:z.user},[_,(0,s.QD)("form",{onSubmit:t[4]||(t[4]=(0,o.Y7)(((...e)=>C.sendComment&&C.sendComment(...e)),["prevent"]))},[(0,s.wt)((0,s.QD)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>z.commentBox=e),id:"commentBox",class:"event__commentbox"},null,512),[[o.Og,z.commentBox]]),(0,s.QD)("button",{onSubmit:t[3]||(t[3]=(...e)=>C.sendComment&&C.sendComment(...e)),class:"event__commentbox__button"},"Enviar comentario",32)],32)])):(0,s.g1)("",!0),z.comments?((0,s.Wz)(),(0,s.An)("section",g,[A,((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(z.comments,(e=>((0,s.Wz)(),(0,s.An)("article",f,[(0,s.QD)("div",W,[(0,s.QD)("p",null,(0,a.WA)(e.name),1)]),(0,s.QD)("div",b,[(0,s.QD)("p",null,(0,a.WA)(e.commentText),1)])])))),256))])):(0,s.g1)("",!0)])):(0,s.g1)("",!0)}var z=n(3220);const C=(0,z.I)(["token"]);var D={data(){return{event:null,comments:null,user:null,saved:null,commentBox:"",token:C.get("token")}},props:{id:{type:String,required:!0}},async created(){const e=await fetch(`https://app.ticketmaster.com/discovery/v2/events/${this.id}.json?apikey=S1sDAS05dZI5JmtvdarQaZN5tFxkOUpr`),t=await e.json();this.event=t,C.addChangeListener((()=>{this.token=C.get("token"),this.checkUser()}))},async mounted(){await this.checkUser(),await this.updateComments(),await this.checkIfSaved()},methods:{async sendComment(){console.log(this.user.id,this.$props.id,this.commentBox);const e=await fetch("http://localhost:8000/api/comments",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userId:this.user.id,eventId:this.$props.id,commentText:this.commentBox})});await e.json();this.updateComments()},async updateComments(){const e=await fetch(`http://localhost:8000/api/comments/${this.$props.id}`),t=await e.json();this.comments=t},async saveEvent(){await fetch("http://localhost:8000/api/saved",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userId:this.user.id,eventId:this.$props.id,eventName:this.event.name,eventImageSource:this.event.images[0].url})});this.checkIfSaved()},async removeEvent(){await fetch(`http://localhost:8000/api/saved/${this.saved.id}`,{method:"delete",headers:{Authorization:"Bearer "+C.get("token")}});this.saved=null},async checkUser(){if(this.token){const e=await fetch("http://localhost:8000/api/user",{method:"get",headers:{Authorization:"Bearer "+C.get("token")}}),t=await e.json();t.message?C.remove("token",{path:"/"}):this.user=t}else this.user=null},async checkIfSaved(){if(this.user){const e=await fetch(`http://localhost:8000/api/saved/${this.user.id}`,{method:"get"}),t=await e.json(),n=t.find((e=>e.eventId===this.$props.id));this.saved=n||null}}}},Q=n(4100);const x=(0,Q.c)(D,[["render",w]]);var B=x}}]);
//# sourceMappingURL=440.0e0a43a3.js.map